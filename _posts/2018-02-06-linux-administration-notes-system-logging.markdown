---
layout: post
title:  "Linux Administration - Notes: System Logging"
date:   2018-02-06 11:11:11 -0500
categories: linux logging
---

Content

* TOC
{:toc}

#Syslog Standard
- Message logging.
- Centrally controlled.
- Facilities (code) and severities (level) to categorize messages.


Facilities Table

|--------+-----------+------------------------|
| Number |  Keyword  |       Description      |
|:------:|:---------:|-----------------------:|
| 0      | kern      | kernel                 |
| 1      | user      | user-level             |
| 2      | mail      | mail system            |
| 3      | daemon    | system daemons         |
| 4      | auth      | security / auth        |
| 5      | syslog    | generated by syslogd   |
| 6      | lpr       | line printer subsystem |
| 7      | news      | network news subsystem |
| 8      | uucp      | UUCP subsystem         |
| 9      | clock     | daemon                 |
| 10     | authpriv  | security / auth        |
| 11     | ftp       | FTP daemon             |
| 12     | -         | NTP subsystem          |
| 13     | -         | log audit              |
| 14     | -         | log alert              |
| 15     | cron      | clock daemon           |
| 16     | local0    | (local0)               |
| 17     | local1    | (local1)               |
| 18     | local2    | (local2)               |
| 19     | local3    | (local3)               |
| ...    | ...       | ...                    |
| 23     | local7    | (local7)               |
  
  
Severities Table

|------+-----------+----------------+------------------------|
| Code | Severity  |  Keyword       |       Description      |
|:----:|:---------:|:--------------:|-----------------------:|
|  0   | Emergency | emerg (panic)  | System is unusable     |
|  1   | Alert     | alert          | Action must be taken   |
|  2   | Critical  | crit           | Critical conditions    |
|  3   | Error     | err (error)    | Error conditions       |
|  4   | Warning   | warning (warn) | Warning conditions     |
|  5   | Notice    | emerg (panic)  | Normal but...          |
|  6   | Info      | info           | Informational          |
|  7   | Debug     | debug          | Debug-level            |

# Syslog Servers
- syslogd.
- rsyslog.
- syslog-ng.

# rsyslog
- Configuration: `/etc/rsyslog.conf`.
- Additional configuration files, e.g. `$IncludeConfig /etc/rsyslog.d/*.conf`.

# Logging Rules
- Selector field: lists the facilities (e.g. `mail`) and severities(e.g. `alert`) of messages to include in the rule.
  - The format of this is field : `Facility.Severity` (wildcards `*` are supported)
  - E.g. to match all the messages from a facility: 
    - `Facility.*`
    - `Facility`
  - E.g. to not match any messages from a facility: `Facility.none`.
  - E.g. to match specific facilities and severities: `Facility_1.Severity;Facility_2.Severity`.
- Action field: determines how a message (matched by the selector field) is processed, e.g. write the message to a log file.
- E.g rule to write all messages from `mail` faciltiy to `/var/log/mail.log`:
`mail.*      /var/log/mail.log`.

# Caching vs Non-caching
- Caching is used if the path starts with a hyphen, e.g. `mail.info     -/var/log/mail.info`.
- You may loose some messages during a system crash if you are using caching mode.
- Caching mode can improve I/O performance (good if you are logging a lot of messages).
- Usually caching is for less critical messages (e.g. if the severity is `info`) use caching:
  - `mail.info       -/var/log/mail.info`
  - `mail.warn       -/var/log/mail.warn`
  - `mail.err        /var/log/mail.err`

# logger command
- Generate log message.
- Syntax: `logger [options] message`.
- Options:
  - `-p Facility.Severity` (otherwise default: `user.notice`)
  - `-t Tag`
- E.g. 
  - `logger -p mail.info -t mailtest "Test."`
  - `sudo tail -1 /var/log/mail.log`
  - `Apr 4 14:33:16 linuxsvr mailtest: Test`

# logrotate command
- Compress, remove and even mail log files.
- Configuration: `/etc/logrotate.conf`.
- Additional configuration files, e.g. `include /etc/logrotate.d`.
- Configuration example:
  - `weekly`: rotated every week.
  - `missingok`: ignore missing log files.
  - `notifempty`: indicates the logrotate to not rotate the log file if it is empty.
  - `compress`: compress the rotated log files (gzip).
  - `postrotate` - `endscript`: the commands in between are executed after the rotation.
  - `rotate 4`: keep 4 weeks worth of logs (older ones will be removed).
  - `create`: make sure a new empty file will be created after rotation.
- Test a configuration: `logrotate -fv /etc/logrotate.conf`.
